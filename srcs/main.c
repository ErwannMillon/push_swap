/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.c                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: gmillon <marvin@42.fr>                     +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/04/03 23:07:14 by gmillon           #+#    #+#             */
/*   Updated: 2022/09/07 14:55:19 by gmillon          ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "push_swap.h"

int	is_sorted(t_node *root)
{
	t_node *current;

	current = root;
	while (current)
	{
		if (current->next && current->num > current->next->num)
			return (-1);
		current = current->next;
	}
	return (0);
}

int	main(int argc, char **argv)
{
	t_arr	arr;
	t_arr	sortedarr;
	t_node	*a;
	t_node	*b;
	t_arr	path;
	t_arr	lis;
	// int	test[] = {253, 516, 345, 79, 15, 4, 357, 242, 123, 304, 461, 30, 399, 327, 109, 364, 320, 454, 20, 226, 192, 44, 56, 441, 356, 280, 151, 337, 493, 245, 445, 339, 405, 418, 167, 551, 246, 113, 272, 539, 510, 314, 395, 101, 291, 408, 453, 51, 317, 518, 475, 351, 524, 244, 68, 74, 208, 309, 127, 132, 494, 488, 260, 294, 482, 200, 54, 541, 258, 66, 340, 181, 207, 396, 64, 35, 500, 328, 416, 469, 347, 157, 298, 159, 353, 382, 86, 78, 355, 22, 323, 89, 5, 100, 212, 417, 367, 483, 114, 203, 103, 3, 389, 424, 82, 213, 77, 393, 377, 195, 184, 87, 458, 487, 261, 520, 297, 185, 255, 250, 91, 63, 211, 23, 124, 366, 411, 284, 492, 188, 95, 301, 199, 470, 331, 434, 40, 162, 460, 26, 489, 50, 325, 264, 426, 414, 282, 53, 67, 521, 517, 84, 147, 442, 256, 193, 142, 498, 230, 99, 57, 21, 240, 12, 28, 368, 37, 223, 508, 125, 186, 476, 525, 484, 47, 529, 233, 115, 318, 156, 153, 423, 197, 49, 194, 546, 183, 443, 98, 519, 143, 362, 381, 234, 241, 222, 149, 7, 24, 42, 107, 19, 451, 400, 394, 316, 119, 136, 496, 17, 106, 550, 141, 155, 221, 383, 499, 271, 372, 380, 9, 90, 175, 112, 286, 139, 277, 237, 39, 497, 134, 140, 522, 392, 41, 384, 514, 346, 58, 16, 464, 116, 509, 352, 128, 160, 552, 168, 72, 447, 438, 33, 455, 375, 10, 273, 535, 161, 319, 479, 268, 158, 267, 376, 279, 254, 220, 341, 11, 69, 343, 513, 422, 287, 378, 1, 390, 365, 75, 145, 540, 486, 45, 505, 191, 131, 163, 274, 138, 148, 537, 506, 332, 13, 218, 472, 336, 305, 295, 448, 229, 465, 554, 312, 311, 344, 350, 129, 292, 354, 238, 293, 62, 349, 436, 111, 306, 171, 542, 189, 27, 348, 206, 379, 137, 259, 201, 214, 219, 359, 275, 315, 48, 373, 449, 446, 386, 8, 313, 511, 412, 466, 205, 363, 463, 452, 217, 456, 415, 70, 102, 397, 296, 369, 478, 278, 65, 324, 252, 216, 215, 154, 407, 285, 265, 549, 536, 507, 528, 308, 169, 174, 468, 187, 31, 404, 80, 172, 421, 60, 104, 204, 385, 299, 61, 329, 545, 276, 402, 235, 435, 2, 290, 83, 360, 281, 371, 401, 425, 88, 504, 413, 485, 502, 92, 427, 548, 105, 462, 224, 544, 249, 283, 333, 236, 120, 146, 239, 231, 523, 55, 444, 481, 474, 490, 202, 173, 178, 358, 457, 532, 310, 228, 433, 503, 118, 14, 25, 288, 121, 225, 534, 480, 477, 6, 530, 526, 43, 431, 538, 166, 32, 247, 326, 243, 180, 152, 135, 97, 334, 144, 108, 553, 126, 543, 437, 300, 429, 122, 270, 430, 117, 227, 531, 96, 164, 491, 515, 361, 81, 307, 338, 198, 251, 110, 93, 289, 210, 406, 302, 335, 467, 130, 266, 262, 263, 547, 330, 512, 0};
	int		fail[] = {9, 3, 7, 0, 10, 5, 2, 1, 4, 6, 8};
	// int 	test[] = {428, 531, 177, 237, 132, 407, 63, 197, 178, 433, 114, 277, 496, 378, 418, 283, 134, 485, 200, 179, 2, 202, 373, 41, 198, 440, 429, 23, 241, 74, 537, 431, 517, 286, 102, 264, 33, 233, 269, 228, 26, 353, 544, 90, 307, 398, 494, 252, 410, 476, 153, 350, 111, 339, 215, 138, 472, 181, 397, 370, 539, 300, 172, 273, 554, 61, 211, 125, 103, 199, 499, 148, 288, 548, 369, 208, 190, 156, 105, 167, 40, 170, 49, 196, 387, 254, 15, 116, 59, 489, 173, 169, 109, 541, 408, 29, 290, 401, 127, 310};
	// char *argv_test[] = {"pushswap", "1", "5", "2", "70", "9", "7", "22", "-100", "4", "23", "61", "8", "33"};
	b = NULL;
	arr = parse_args_to_arr(argc, argv);
	// argc = 501;
	// arr.arr = test;
	// arr.len = 500;

	sortedarr.arr = ft_bubble_sort_copy(arr.arr, argc - 1);
	sortedarr.len = argc - 1;
	// ft_print_arr(sortedarr.arr, sortedarr.len);
	a = create_list(arr.arr, argc -1, sortedarr);
	if (DEBUG)
		ft_print_list(a);
	lis = get_rotating_lis(arr.arr, argc - 1);
	if (DEBUG)
	{
		ft_printf("LIS:\n");
		ft_print_arr(lis.arr, lis.len);
	}
	path = move_unsorted_to_b(&a, &b, arr, lis);
	if (DEBUG)
	{ 
		// print_path(path);
		ft_printf("Stacks after move unsorted to b\n");
		ft_print_stacks(a, b);
	}
	path = extend_path(path, reinsert_sort(&a, &b));
	path = extend_path(path, move_min_to_start(&a));
	
	if (DEBUG)
	{
	ft_printf("FINAL:\n");
	ft_print_list(a);

	}
	// print_path(path);
	print_path_output(path);
	if (DEBUG)
	{
	ft_printf("path.len: %d\n", path.len);
	ft_printf("is_sorted: %d\n", is_sorted(a));

	}
	free(path.arr);
	exit_cleanup(lis, sortedarr, a, arr);
}
